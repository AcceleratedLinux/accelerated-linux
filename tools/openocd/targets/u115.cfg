#
# u115.cfg -- configuration support for Accelerated Concepts U115
#
# (C) Copyright 2014-2018, greg.ungerer@accelerated.com
#

#source [find interface/jtagkey.cfg]
source [find interface/jtag-lock-pick_tiny_2.cfg]
#source [find interface/ftdi/jtag-lock-pick_tiny_2.cfg]

reset_config trst_and_srst
adapter_nsrst_delay 200
jtag_ntrst_delay 200
adapter_khz 1000

proc mmu_off {} {
	set cp [arm mrc 15 0 1 0 0]
	set cp [expr ($cp & ~1)]
	arm mcr 15 0 1 0 0 $cp
}

proc mmu_on {} {
	set cp [arm mrc 15 0 1 0 0]
	set cp [expr ($cp | 1)]
	arm mcr 15 0 1 0 0 $cp
}

proc cpu_start_state {} {
	# ARM state, supervisor mode, irq and fiq disable
	reg cpsr 0x000000d3
	# MMU off, cache off
	#arm mcr 15 0 1 0 0 0x78
}

source [find tools/openocd/platforms/armada/armada380.tcl]

proc meminit {} {
	halt
	cpu_start_state
	load_image boot/build/u-boot-2013.01-armada-17.06.3/tools/marvell/bin_hdr/bin_hdr.elf
	reg pc 0x40000030
	resume
}

proc loaduboot {} {
	halt
	load_image boot/build/u-boot-2013.01-armada-17.06.3/u-boot
	cpu_start_state
	mmu_off
	reg pc 0
	#resume
}

