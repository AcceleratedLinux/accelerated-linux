From 34c479f2769d04b37efb39eefa8a3def02254a82 Mon Sep 17 00:00:00 2001
From: Robert Hodaszi <robert.hodaszi@digi.com>
Date: Sat, 15 Jan 2022 00:00:06 +0100
Subject: [PATCH] Don't add prefix to pkg-config files, if it is set to '/'

If prefix is set to '/', include directories in CFLAGS may have the
format like '//include', which may cause build errors.
---
 mesonbuild/modules/pkgconfig.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: meson-1.4.1/mesonbuild/modules/pkgconfig.py
===================================================================
--- meson-1.4.1.orig/mesonbuild/modules/pkgconfig.py
+++ meson-1.4.1/mesonbuild/modules/pkgconfig.py
@@ -497,7 +497,7 @@ class PkgConfigModule(NewExtensionModule
             for optname in optnames:
                 if optname in referenced_vars - varnames:
                     if optname == 'prefix':
-                        ofile.write('prefix={}\n'.format(self._escape(prefix)))
+                        ofile.write('prefix={}\n'.format(self._escape(prefix) if str(prefix) != '/' else ''))
                     else:
                         dirpath = PurePath(_as_str(coredata.get_option(mesonlib.OptionKey(optname))))
                         ofile.write('{}={}\n'.format(optname, self._escape('${prefix}' / dirpath)))
