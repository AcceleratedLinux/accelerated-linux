From 1b5bfe6e149dc6c51039e6b9527a6f67f0eb9168 Mon Sep 17 00:00:00 2001
From: Ken Wilson <ken.wilson@opengear.com>
Date: Thu, 2 Jul 2020 08:06:28 +1000
Subject: [PATCH 1/3] Add extern C statements, replacing BEGIN/END_DECLS

---
 lib/libopengear/include/opengear/fset.h       |  9 ++++++---
 lib/libopengear/include/opengear/ifprobe.h    |  8 ++++++--
 lib/libopengear/include/opengear/modem.h      |  8 ++++++--
 lib/libopengear/include/opengear/network.h    |  8 ++++++--
 lib/libopengear/include/opengear/og_config.h  |  2 ++
 lib/libopengear/include/opengear/pidfile.h    |  8 ++++++--
 lib/libopengear/include/opengear/pmctl.h      |  8 ++++++--
 lib/libopengear/include/opengear/process.h    |  8 ++++++--
 lib/libopengear/include/opengear/pwgrp.h      |  9 +++++++--
 lib/libopengear/include/opengear/serial.h     |  9 ++++++---
 lib/libopengear/include/opengear/stringlib.h  |  8 ++++++--
 lib/libopengear/include/opengear/threadpool.h |  9 ++++++---
 lib/libopengear/include/opengear/users.h      | 10 +++++++---
 lib/libopengear/include/opengear/xml.h        |  8 ++++++--
 lib/libopengear/include/opengear/xmlalert.h   |  8 ++++++--
 lib/libopengear/include/opengear/xmldb.h      |  8 ++++++--
 16 files changed, 94 insertions(+), 34 deletions(-)

diff --git a/lib/libopengear/include/opengear/fset.h b/lib/libopengear/include/opengear/fset.h
index 16f38e9..101aa32 100644
--- a/lib/libopengear/include/opengear/fset.h
+++ b/lib/libopengear/include/opengear/fset.h
@@ -5,8 +5,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 #ifndef DEFAULTOFFS
 #define DEFAULTOFFS 0x000
@@ -41,7 +42,9 @@ void saveFlash(const char * flash, off_t offset);
 int updateflash(const char * flash, off_t offset, const char * write);
 void deleteflash(const char * flash, off_t offset, const char * name);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_FSET_H_ */
 
diff --git a/lib/libopengear/include/opengear/ifprobe.h b/lib/libopengear/include/opengear/ifprobe.h
index 29d8368..30cd0bd 100755
--- a/lib/libopengear/include/opengear/ifprobe.h
+++ b/lib/libopengear/include/opengear/ifprobe.h
@@ -9,7 +9,9 @@
 
 #define MAXVENDORLEN	64
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /** A probed network host. */
 typedef struct opengear_ifprobe_host {
@@ -52,6 +54,8 @@ int opengear_ifprobe_gethosts(opengear_ifprobe_host_t **hosts);
  */
 void opengear_ifprobe_freehosts(opengear_ifprobe_host_t *hosts);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_IFPROBE_H_ */
diff --git a/lib/libopengear/include/opengear/modem.h b/lib/libopengear/include/opengear/modem.h
index 6a636f5..24a4e87 100755
--- a/lib/libopengear/include/opengear/modem.h
+++ b/lib/libopengear/include/opengear/modem.h
@@ -17,7 +17,9 @@
 
 #define M_DEV_SIZE		256
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /** Modem type */
 typedef enum {
@@ -81,6 +83,8 @@ int opengear_modem_getatresponse(
  */
 const char *opengear_modem_getcelliface(void);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_MODEM_H_ */
diff --git a/lib/libopengear/include/opengear/network.h b/lib/libopengear/include/opengear/network.h
index 1b1de55..6a07a41 100755
--- a/lib/libopengear/include/opengear/network.h
+++ b/lib/libopengear/include/opengear/network.h
@@ -9,7 +9,9 @@
 #include <inttypes.h>
 #include <stdbool.h>
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 #define OG_NET_SWITCH_EXEC		"/etc/scripts/switch-config"
 #define OG_NET_MAX_INTERFACES 		64
@@ -145,6 +147,8 @@ int opengear_network_getifaddr( const char * name, char * buf, size_t len );
  */
 int opengear_network_getifmac(const char *name, char *buf, size_t len);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_NETWORK_H_ */
diff --git a/lib/libopengear/include/opengear/og_config.h b/lib/libopengear/include/opengear/og_config.h
index 86f0ff3..9665643 100644
--- a/lib/libopengear/include/opengear/og_config.h
+++ b/lib/libopengear/include/opengear/og_config.h
@@ -1,9 +1,11 @@
 #ifndef _OG_CONFIG
 #define _OG_CONFIG
 
+#if 1
 #include <vendor/autoconf.h>
 #include <config/autoconf.h>
 #include <linux/autoconf.h>
+#endif
 /* Opengear Configuration Header, use this for feature detection */
 
 #if defined(CONFIG_MACH_IM72xx) /* OpenGear/IM72xx, TrippLite/B098 and BlackBox/LES17xxA */
diff --git a/lib/libopengear/include/opengear/pidfile.h b/lib/libopengear/include/opengear/pidfile.h
index 3b6594c..569a27c 100644
--- a/lib/libopengear/include/opengear/pidfile.h
+++ b/lib/libopengear/include/opengear/pidfile.h
@@ -1,7 +1,9 @@
 #ifndef _OPENGEAR_PIDFILE_H_
 #define _OPENGEAR_PIDFILE_H_
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 #define OG_LOCKFILE_PATH "/var/lock/"
 #define OG_PIDFILE_PATH "/var/run/"
@@ -26,6 +28,8 @@ int opengear_pidfile_create_path(const char *path);
 void opengear_pidfile_clear_path(const char *path);
 int opengear_pidfile_valid_path(const char *path);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_PIDFILE_H_ */
diff --git a/lib/libopengear/include/opengear/pmctl.h b/lib/libopengear/include/opengear/pmctl.h
index 1f4ad9a..6531a79 100755
--- a/lib/libopengear/include/opengear/pmctl.h
+++ b/lib/libopengear/include/opengear/pmctl.h
@@ -3,7 +3,9 @@
 
 #include <scew/scew.h>
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 typedef struct pmctl pmctl_t;
 
@@ -48,6 +50,8 @@ int pmctl_unreserve_port(pmctl_t *pm, const char *portname);
 int pmctl_xml_request(pmctl_t *pm, const scew_tree *request,
     int (*func)(void *ptr, const scew_tree *response), void *cbptr);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_PMCTL_H_ */
diff --git a/lib/libopengear/include/opengear/process.h b/lib/libopengear/include/opengear/process.h
index 28b9022..57a094a 100755
--- a/lib/libopengear/include/opengear/process.h
+++ b/lib/libopengear/include/opengear/process.h
@@ -3,7 +3,9 @@
 
 #include <inttypes.h>
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 typedef enum {
 	OG_PROC_NONE	= (2 << 0),
@@ -102,6 +104,8 @@ int opengear_proc_get_pids(const char * const argv[], int argc,
  */
 int opengear_proc_find_comms(const char *comm, pid_t *pids, int maxpids);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_NETWORK_H_ */
diff --git a/lib/libopengear/include/opengear/pwgrp.h b/lib/libopengear/include/opengear/pwgrp.h
index ea035d8..b518f80 100644
--- a/lib/libopengear/include/opengear/pwgrp.h
+++ b/lib/libopengear/include/opengear/pwgrp.h
@@ -24,7 +24,9 @@
 #endif
 #include <stdarg.h>
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /** Duplicates a passwd entry.
  *  @returns a passwd structure with managed strings. */
@@ -175,5 +177,8 @@ char *pwgrp_setf(char **destp, const char *fmt, ...);
 
 char *pwgrp_vsetf(char **destp, const char *fmt, va_list ap);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
+
 #endif /* _OPENGEAR_PWGRP_H_ */
diff --git a/lib/libopengear/include/opengear/serial.h b/lib/libopengear/include/opengear/serial.h
index cc4699d..4370e0e 100755
--- a/lib/libopengear/include/opengear/serial.h
+++ b/lib/libopengear/include/opengear/serial.h
@@ -12,8 +12,9 @@
 #define OG_MAX_PORTS    10000
 #define OG_MAX_PORTDEV	"port10000"
 
-__BEGIN_DECLS
-
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /**
  * Counts the number of serial ports attached to the system.
@@ -81,6 +82,8 @@ const char *opengear_serial_displayname(xmldb_t *db, int portnr);
  */
 const char *opengear_serial_label(xmldb_t *db, int portnr);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_SERIAL_H_ */
diff --git a/lib/libopengear/include/opengear/stringlib.h b/lib/libopengear/include/opengear/stringlib.h
index 9adf905..15bcb15 100644
--- a/lib/libopengear/include/opengear/stringlib.h
+++ b/lib/libopengear/include/opengear/stringlib.h
@@ -1,7 +1,9 @@
 #ifndef _OPENGEAR_STRINGLIB_H_
 #define _OPENGEAR_STRINGLIB_H_
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /* This function will replace any instances of old_str in str with rep_str
  * str is assumed to be a malloc'ed string, and will be resized with realloc 
@@ -43,6 +45,8 @@ size_t trimwhitespace(char *out, size_t len, const char *str);
  */
 char *trimwhitespace_inplace(char *str);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_STRINGLIB_H_ */
diff --git a/lib/libopengear/include/opengear/threadpool.h b/lib/libopengear/include/opengear/threadpool.h
index 4611478..bf41754 100755
--- a/lib/libopengear/include/opengear/threadpool.h
+++ b/lib/libopengear/include/opengear/threadpool.h
@@ -2,8 +2,9 @@
 #define _OPENGEAR_THREADS_H_
 
 
-__BEGIN_DECLS
-
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /** A task which can be performed in parallel. */
 typedef void (og_threadtaskfunc_t)(
@@ -104,6 +105,8 @@ void og_threadpool_lock(og_threadpool_t *pool);
  */
 void og_threadpool_unlock(og_threadpool_t *pool);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_THREADS_H_ */
diff --git a/lib/libopengear/include/opengear/users.h b/lib/libopengear/include/opengear/users.h
index d7f3ec4..3be7557 100644
--- a/lib/libopengear/include/opengear/users.h
+++ b/lib/libopengear/include/opengear/users.h
@@ -7,14 +7,16 @@
 
 #include <stdbool.h>
 
-#include <scew/types.h>
+#include <scew/scew.h>
 
 #include <opengear/xmldb.h>
 #include <opengear/og_config.h>
 
 #define OG_ALLOW_ALL (size_t)-1
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /**
  * Determine if the given user is a member of the given group.
@@ -202,6 +204,8 @@ int getNextUid();
  */
 char **opengear_users_getlocalgroups(xmldb_t *db, const char *username, size_t *num_groups);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_USERS_H_ */
diff --git a/lib/libopengear/include/opengear/xml.h b/lib/libopengear/include/opengear/xml.h
index d06ee62..62dba9a 100755
--- a/lib/libopengear/include/opengear/xml.h
+++ b/lib/libopengear/include/opengear/xml.h
@@ -5,7 +5,9 @@
 #include <stdbool.h>
 #include <stdint.h>
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 const char *scew_xml_error(scew_parser *);
 const char *scew_xml_string(const scew_element *);
@@ -64,6 +66,8 @@ bool xml_get_string(const scew_element* node, XML_Char const* name,
 bool xml_copy_string(const scew_element* node, XML_Char const* name, char** value);
 
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_PMCTL_H_ */
diff --git a/lib/libopengear/include/opengear/xmlalert.h b/lib/libopengear/include/opengear/xmlalert.h
index f26e6be..6e2eca6 100755
--- a/lib/libopengear/include/opengear/xmlalert.h
+++ b/lib/libopengear/include/opengear/xmlalert.h
@@ -4,7 +4,9 @@
 #include <scew/scew.h>
 #include <stdbool.h>
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 int
 xml_alert_create(const char *alertType, const char* xmlId,
@@ -13,6 +15,8 @@ xml_alert_create(const char *alertType, const char* xmlId,
 int
 xml_alert_save(scew_tree *tree, const char* alertName, int XMLIDNumber);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_XMLALERT_H_ */
diff --git a/lib/libopengear/include/opengear/xmldb.h b/lib/libopengear/include/opengear/xmldb.h
index e7e6321..916f2fb 100755
--- a/lib/libopengear/include/opengear/xmldb.h
+++ b/lib/libopengear/include/opengear/xmldb.h
@@ -13,7 +13,9 @@
 
 #define XMLDB_DEFAULT_CONFIG "/etc/config/config.xml"
 
-__BEGIN_DECLS
+#ifdef __cplusplus
+extern "C" {
+#endif
 
 /**
  * An opaque type which handles an XML database.
@@ -146,6 +148,8 @@ int xmldb_getchar(xmldb_t *db, const char *id, const char *field);
  */
 bool * xmldb_portlist(xmldb_t *db, const char *id, int *num_ports);
 
-__END_DECLS
+#ifdef __cplusplus
+}
+#endif
 
 #endif /* _OPENGEAR_XMLDB_H_ */
-- 
2.17.1

