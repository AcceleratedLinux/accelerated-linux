thisconfigdir=../../..
myfulldir=lib/gssapi/krb5
mydir=lib/gssapi/krb5
BUILDTOP=$(REL)..$(S)..$(S)..
LOCALINCLUDES = -I. -I$(srcdir) -I$(srcdir)/.. -I../generic -I$(srcdir)/../generic -I../mechglue -I$(srcdir)/../mechglue
DEFS=-D_GSS_STATIC_LINK=1

#PROG_LIBPATH=-L$(TOPLIBD)
#PROG_RPATH=$(KRB5_LIBDIR)
#MODULE_INSTALL_DIR = $(GSS_MODULE_DIR)
#LIBBASE=mech_krb5
#LIBMAJOR=0
#LIBMINOR=0
#SO_EXT=.so
#LIBINITFUNC=gss_krb5int_init
#LIBFINIFUNC=gss_krb5int_fini
#STOBJLISTS=../generic/OBJS.ST OBJS.ST
#SUBDIROBJLISTS=../generic/OBJS.ST
#SHLIB_EXPDEPS=$(KRB5_DEPLIB) $(CRYPTO_DEPLIB) $(SUPPORT_DEPLIB) $(COM_ERR_DEPLIB)
#SHLIB_EXPLIBS=-lkrb5 -lk5crypto -lcom_err $(SUPPORT_LIB) $(DL_LIB) $(LIBS)
#SHLIB_DIRS=-L$(TOPLIBD)
#SHLIB_RDIRS=$(KRB5_LIBDIR)
#RELDIR=gssapi/krb5

##DOS##BUILDTOP = ..\..\..
##DOS##PREFIXDIR=krb5
##DOS##OBJFILE = ..\$(OUTPRE)krb5.lst

##DOS##DLL_EXP_TYPE=GSS

include_stdint=@include_stdint@
##DOS##include_stdint=
ETSRCS= gssapi_err_krb5.c
ETOBJS= $(OUTPRE)gssapi_err_krb5.$(OBJEXT)
ETHDRS= gssapi_err_krb5.h

$(OUTPRE)gssapi_err_krb5.$(OBJEXT): gssapi_err_krb5.c
gssapi_err_krb5.h: gssapi_err_krb5.et
gssapi_err_krb5.c: gssapi_err_krb5.et

SRCS = \
	$(srcdir)/accept_sec_context.c \
	$(srcdir)/acquire_cred.c \
	$(srcdir)/add_cred.c \
	$(srcdir)/canon_name.c \
	$(srcdir)/compare_name.c \
	$(srcdir)/context_time.c \
	$(srcdir)/copy_ccache.c \
	$(srcdir)/delete_sec_context.c \
	$(srcdir)/disp_name.c \
	$(srcdir)/disp_status.c \
	$(srcdir)/duplicate_name.c \
	$(srcdir)/export_name.c \
	$(srcdir)/export_sec_context.c \
	$(srcdir)/get_tkt_flags.c \
	$(srcdir)/gssapi_krb5.c \
	$(srcdir)/import_name.c \
	$(srcdir)/import_sec_context.c \
	$(srcdir)/indicate_mechs.c \
	$(srcdir)/init_sec_context.c \
	$(srcdir)/inq_context.c \
	$(srcdir)/inq_cred.c \
	$(srcdir)/inq_names.c \
	$(srcdir)/k5seal.c \
	$(srcdir)/k5sealiov.c \
	$(srcdir)/k5sealv3.c \
	$(srcdir)/k5sealv3iov.c \
	$(srcdir)/k5unseal.c \
	$(srcdir)/k5unsealiov.c \
	$(srcdir)/krb5_gss_glue.c \
	$(srcdir)/lucid_context.c \
	$(srcdir)/process_context_token.c \
	$(srcdir)/rel_cred.c \
	$(srcdir)/rel_oid.c \
	$(srcdir)/rel_name.c \
	$(srcdir)/seal.c \
	$(srcdir)/set_allowable_enctypes.c \
	$(srcdir)/ser_sctx.c \
	$(srcdir)/set_ccache.c \
	$(srcdir)/sign.c \
	$(srcdir)/unseal.c \
	$(srcdir)/util_cksum.c \
	$(srcdir)/util_crypt.c \
	$(srcdir)/util_seed.c \
	$(srcdir)/util_seqnum.c \
	$(srcdir)/val_cred.c \
	$(srcdir)/verify.c \
	$(srcdir)/wrap_size_limit.c 


OBJS = \
	$(OUTPRE)accept_sec_context.$(OBJEXT) \
	$(OUTPRE)acquire_cred.$(OBJEXT) \
	$(OUTPRE)add_cred.$(OBJEXT) \
	$(OUTPRE)canon_name.$(OBJEXT) \
	$(OUTPRE)compare_name.$(OBJEXT) \
	$(OUTPRE)context_time.$(OBJEXT) \
	$(OUTPRE)copy_ccache.$(OBJEXT) \
	$(OUTPRE)delete_sec_context.$(OBJEXT) \
	$(OUTPRE)disp_name.$(OBJEXT) \
	$(OUTPRE)disp_status.$(OBJEXT) \
	$(OUTPRE)duplicate_name.$(OBJEXT) \
	$(OUTPRE)export_name.$(OBJEXT) \
	$(OUTPRE)export_sec_context.$(OBJEXT) \
	$(OUTPRE)get_tkt_flags.$(OBJEXT) \
	$(OUTPRE)gssapi_krb5.$(OBJEXT) \
	$(OUTPRE)import_name.$(OBJEXT) \
	$(OUTPRE)import_sec_context.$(OBJEXT) \
	$(OUTPRE)indicate_mechs.$(OBJEXT) \
	$(OUTPRE)init_sec_context.$(OBJEXT) \
	$(OUTPRE)inq_context.$(OBJEXT) \
	$(OUTPRE)inq_cred.$(OBJEXT) \
	$(OUTPRE)inq_names.$(OBJEXT) \
	$(OUTPRE)k5seal.$(OBJEXT) \
	$(OUTPRE)k5sealiov.$(OBJEXT) \
	$(OUTPRE)k5sealv3.$(OBJEXT) \
	$(OUTPRE)k5sealv3iov.$(OBJEXT) \
	$(OUTPRE)k5unseal.$(OBJEXT) \
	$(OUTPRE)k5unsealiov.$(OBJEXT) \
	$(OUTPRE)krb5_gss_glue.$(OBJEXT) \
	$(OUTPRE)lucid_context.$(OBJEXT) \
	$(OUTPRE)process_context_token.$(OBJEXT) \
	$(OUTPRE)rel_cred.$(OBJEXT) \
	$(OUTPRE)rel_oid.$(OBJEXT) \
	$(OUTPRE)rel_name.$(OBJEXT) \
	$(OUTPRE)seal.$(OBJEXT) \
	$(OUTPRE)set_allowable_enctypes.$(OBJEXT) \
	$(OUTPRE)ser_sctx.$(OBJEXT) \
	$(OUTPRE)set_ccache.$(OBJEXT) \
	$(OUTPRE)sign.$(OBJEXT) \
	$(OUTPRE)unseal.$(OBJEXT) \
	$(OUTPRE)util_cksum.$(OBJEXT) \
	$(OUTPRE)util_crypt.$(OBJEXT) \
	$(OUTPRE)util_seed.$(OBJEXT) \
	$(OUTPRE)util_seqnum.$(OBJEXT) \
	$(OUTPRE)val_cred.$(OBJEXT) \
	$(OUTPRE)verify.$(OBJEXT) \
	$(OUTPRE)wrap_size_limit.$(OBJEXT) \
	$(OUTPRE)gssapi_err_krb5.$(OBJEXT)

#	k5mech.$(OBJEXT) \
#	pname_to_uid.$(OBJEXT)

STLIBOBJS = \
	accept_sec_context.o \
	acquire_cred.o \
	add_cred.o \
	canon_name.o \
	compare_name.o \
	context_time.o \
	copy_ccache.o \
	delete_sec_context.o \
	disp_name.o \
	disp_status.o \
	duplicate_name.o \
	export_name.o \
	export_sec_context.o \
	get_tkt_flags.o \
	gssapi_krb5.o \
	import_name.o \
	import_sec_context.o \
	indicate_mechs.o \
	init_sec_context.o \
	inq_context.o \
	inq_cred.o \
	inq_names.o \
	k5seal.o \
	k5sealiov.o \
	k5sealv3.o \
	k5sealv3iov.o \
	k5unseal.o \
	k5unsealiov.o \
	krb5_gss_glue.o \
	lucid_context.o \
	process_context_token.o \
	rel_cred.o \
	rel_oid.o \
	rel_name.o \
	seal.o \
	set_allowable_enctypes.o \
	ser_sctx.o \
	set_ccache.o \
	sign.o \
	unseal.o \
	util_cksum.o \
	util_crypt.o \
	util_seed.o \
	util_seqnum.o \
	val_cred.o \
	verify.o \
	wrap_size_limit.o \
	gssapi_err_krb5.o

#	k5mech.o \
#	pname_to_uid.o

HDRS= $(ETHDRS)

EHDRDIR=$(BUILDTOP)$(S)include$(S)gssapi
EXPORTED_HEADERS= gssapi_krb5.h

##DOS##LIBOBJS = $(OBJS)

GSSAPI_KRB5_HDR=$(EHDRDIR)$(S)gssapi_krb5.h

all-windows:: $(EHDRDIR) $(GSSAPI_KRB5_HDR) $(SRCS) $(HDRS)

##DOS##$(EHDRDIR):
##DOS##	mkdir $(EHDRDIR)

MK_EHDRDIR=if test -d $(EHDRDIR); then :; else (set -x; mkdir $(EHDRDIR)); fi
##DOS##MK_EHDRDIR=rem

$(GSSAPI_KRB5_HDR): gssapi_krb5.h
	@$(MK_EHDRDIR)
	$(CP) gssapi_krb5.h "$@"

all-unix:: $(SRCS) $(HDRS) $(GSSAPI_KRB5_HDR) includes
all-unix:: all-libobjs

error_map.h: $(SRCTOP)/util/gen-map.pl $(SRCTOP)/util/ktemplate.pm Makefile
	$(PERL) -I$(SRCTOP)/util $(SRCTOP)/util/gen-map.pl -oerror_map.new \
		NAME=gsserrmap \
		KEY=OM_uint32 \
		VALUE="char *" \
		COMPARE=compare_OM_uint32 \
		FREEVALUE=free_string
	$(MV) error_map.new error_map.h

clean-unix::
	$(RM) $(BUILDTOP)/include/gssapi/gssapi_krb5.h
	-$(RM) gssapi_krb5.h error_map.h

clean-unix:: clean-libobjs
	$(RM) $(ETHDRS) $(ETSRCS)

clean-windows::
	$(RM) $(EHDRDIR)\gssapi_krb5.h
	$(RM) error_map.h
	-if exist $(EHDRDIR)\nul rmdir $(EHDRDIR)


generate-files-mac: gssapi_krb5.h error_map.h

##DOS##!if 0
gssapi_krb5.h: gssapi_krb5.hin
	@echo "Creating gssapi.h" ; \
	h=gss$$$$; $(RM) $$h; \
	(echo "/* This is the gssapi_krb5.h prologue. */"; \
	$(include_stdint) ; \
	echo "/* End of gssapi_krb5.h prologue. */"; \
	cat $(srcdir)/gssapi_krb5.hin )> $$h && \
	(set -x; $(MV) $$h $@) ; e=$$?; $(RM) $$h; exit $$e
##DOS##!endif
##DOS### No prologue needed for Windows, the support is
##DOS### in gssapi_krb5.hin already.
##DOS##gssapi_krb5.h: gssapi_krb5.hin
##DOS##	$(CP) gssapi_krb5.hin gssapi_krb5.h

install-headers-unix install::
	@set -x; for f in $(EXPORTED_HEADERS) ; \
	do $(INSTALL_DATA) $$f	\
		$(DESTDIR)$(KRB5_INCDIR)/gssapi/$$f ; \
	done

depend:: $(ETSRCS)

includes::  gssapi_krb5.h

install::

@libobj_frag@

