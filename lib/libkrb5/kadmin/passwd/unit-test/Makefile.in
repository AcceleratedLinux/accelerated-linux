thisconfigdir=../../..
myfulldir=kadmin/passwd/unit-test
mydir=kadmin/passwd/unit-test
BUILDTOP=$(REL)..$(S)..$(S)..
check unit-test:: unit-test-@DO_TEST@

unit-test-:
	@echo "+++"
	@echo "+++ WARNING: kpasswd unit tests not run."
	@echo "+++ Either tcl, runtest, or Perl is unavailable."
	@echo "+++"

unit-test-ok:: unit-test-setup unit-test-body unit-test-cleanup

unit-test-body::	
	$(ENV_SETUP) $(RUNTEST) --tool kpasswd KPASSWD=../kpasswd \
		KINIT=$(BUILDTOP)/clients/kinit/kinit \
		KDESTROY=$(BUILDTOP)/clients/kdestroy/kdestroy \
		PRIOCNTL_HACK=@PRIOCNTL_HACK@ VALGRIND="$(VALGRIND)"

unit-test-setup::
	$(ENV_SETUP) $(VALGRIND) $(START_SERVERS)

unit-test-cleanup::
	$(ENV_SETUP) $(STOP_SERVERS)
clean::
	$(RM) dbg.log kpasswd.sum kpasswd.log
