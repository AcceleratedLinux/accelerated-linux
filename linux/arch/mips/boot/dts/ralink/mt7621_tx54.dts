/dts-v1/;

#include "mt7621.dtsi"
#include <dt-bindings/gpio/gpio.h>

/ {
	model = "Digi TX54";
	compatible = "digi,tx54", "mediatek,mt7621-soc";

	memory@0 {
		device_type = "memory";
		reg = <0x0 0x10000000>;
	};
};

&pcie {
	pinctrl-names = "default";
	pinctrl-0 = <&pcie_pins>;
	status = "okay";
};

&nand {
	status = "okay";
	pin-ctrl-names = "default";
	pinctrl-0 = <&nand_pins>;
	mediatek,nand-bbt-compat;

	partition@0 {
		label = "all";
		reg = <0x00000000 0>;
	};
	partition@1 {
		label = "u-boot";
		reg = <0x00000000 0x00200000>;
	};
	partition@2 {
		label = "u-boot-env";
		reg = <0x00200000 0x00100000>;
	};
	partition@3 {
		label = "u-boot-env1";
		reg = <0x00300000 0x00100000>;
	};
	partition@4 {
		label = "flash";
		reg = <0x00400000 0x09c00000>;
	};
	partition@5 {
		label = "userfs";
		reg = <0x0a000000 0x15f40000>;
	};
	partition@6 {
		label = "csid";
		reg = <0x1ff40000 0x00020000>;
	};
	partition@7 {
		label = "odm";
		reg = <0x1ff60000 0x00020000>;
	};
};

&ethernet {
	status = "okay";

	gmac0: mac@0 {
		compatible = "mediatek,eth-mac";
		reg = <0>;
		phy-mode = "rgmii";

		fixed-link {
			speed = <1000>;
			full-duplex;
			pause;
		};
	};

	mdio-bus {
		#address-cells = <1>;
		#size-cells = <0>;

		switch@0 {
			compatible = "mediatek,mt7621", "mediatek,mt7530";
			reg = <0>;

			ports {
				#address-cells = <1>;
				#size-cells = <0>;

				port@0 {
					reg = <1>;
					label = "eth1";
				};

				port@1 {
					reg = <2>;
					label = "eth2";
				};

				port@2 {
					reg = <3>;
					label = "eth3";
				};

				port@3 {
					reg = <4>;
					label = "eth4";
				};

				port@6 {
					reg = <6>;
					label = "cpu";
					ethernet = <&gmac0>;
					phy-mode = "rgmii";

					fixed-link {
						speed = <1000>;
						full-duplex;
						pause;
					};
				};
			};
		};
	};
};

&i2c {
	clock-frequency = <400000>;
	status = "okay";

	mcp23017: mcp23017@21 {
		compatible = "microchip,mcp23017";
		reg = <0x21>;
	};

	temp: lm73@48 {
		compatible = "lm73";
		reg = <0x48>;
	};

	adxl343: adxl343@56 {
		compatible = "adi,adxl345";
		reg = <0x56>;
	};

	rng: atsh204@80 {
		compatible = "atsha204-i2c";
		reg = <0x60>;
	};

	rtc: ds3232@68 {
		compatible = "dallas,ds3232";
		reg = <0x68>;
	};
};

/*
 * The mediatek legacy 3.10 kernel probes the UARTs in a different order.
 * To preserve the ports associated with ttyS0 and ttyS1 switch the MMIO
 * addresses and IRQs for UART 0 and UART 1.
 */
&uartlite0 {
	status = "okay";
	reg = <0xd00 0x100>;
	interrupts = <GIC_SHARED 27 IRQ_TYPE_LEVEL_HIGH>;
};

&uartlite1 {
	status = "okay";
	reg = <0xc00 0x100>;
	interrupts = <GIC_SHARED 26 IRQ_TYPE_LEVEL_HIGH>;
};

&pinctrl {
	state_default: pinctrl0 {
		gpio {
			group = "rgmii2";
			function = "gpio";
		};
	};
};
