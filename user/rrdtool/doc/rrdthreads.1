.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.14
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "RRDTHREADS 1"
.TH RRDTHREADS 1 "2005-06-17" "1.2.10" "rrdtool"
.SH "NAME"
rrdthreads \- Provisions for linking the RRD library to use in multi\-threaded programs
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
Using librrd in multi-threaded programs requires some extra
precautions, as the \s-1RRD\s0 library in its original form was not
thread-safe at all. This document describes requirements and pitfalls
on the way to use the multi-threaded version of librrd in your own
programs. It also gives hints for future \s-1RRD\s0 development to keep the
library thread\-safe.
.PP
Currently only some \s-1RRD\s0 operations are implemented in a thread-safe
way. They all end in the usual "\f(CW\*(C`_r\*(C'\fR" suffix.
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
In order to use librrd in multi-threaded programs you must:
.IP "\(bu" 4
Link with \fIlibrrd_th\fR instead of \fIlibrrd\fR (use \f(CW\*(C`\-lrrd_th\*(C'\fR when
linking)
.IP "\(bu" 4
Use the "\f(CW\*(C`_r\*(C'\fR" functions instead of the normal API-functions
.IP "\(bu" 4
Do not use any at-style time specifications. Parsing of such time
specifications is terribly non\-thread\-safe.
.IP "\(bu" 4
Never use non *\f(CW\*(C`_r\*(C'\fR functions unless it is explicitly documented that
the function is tread\-safe.
.IP "\(bu" 4
Every thread \s-1SHOULD\s0 call \f(CW\*(C`rrd_get_context()\*(C'\fR before its first call to
any \f(CW\*(C`librrd_th\*(C'\fR function in order to set up thread specific data. This
is not strictly required, but it is the only way to test if memory
allocation can be done by this function. Otherwise the program may die
with a \s-1SIGSEGV\s0 in a low-memory situation.
.IP "\(bu" 4
Always call \f(CW\*(C`rrd_error_clear()\*(C'\fR before any call to the
library. Otherwise the call might fail due to some earlier error.
.Sh "\s-1NOTES\s0 \s-1FOR\s0 \s-1RRD\s0 \s-1CONTRIBUTORS\s0"
.IX Subsection "NOTES FOR RRD CONTRIBUTORS"
Some precautions must be followed when developing \s-1RRD\s0 from now on:
.IP "\(bu" 4
Only use thread-safe functions in library code. Many often used libc
functions aren't thread\-safe. Take care in the following
situations or when using the following library functions:
.RS 4
.IP "\(bu" 4
Direct calls to \f(CW\*(C`strerror()\*(C'\fR must be avoided: use \f(CW\*(C`rrd_strerror()\*(C'\fR
instead, it provides a per-thread error message.
.IP "\(bu" 4
The \f(CW\*(C`getpw*\*(C'\fR, \f(CW\*(C`getgr*\*(C'\fR, \f(CW\*(C`gethost*\*(C'\fR function families (and some more
\&\f(CW\*(C`get*\*(C'\fR functions) are not thread\-safe: use the *\f(CW\*(C`_r\*(C'\fR variants
.IP "\(bu" 4
Time functions: \f(CW\*(C`asctime\*(C'\fR, \f(CW\*(C`ctime\*(C'\fR, \f(CW\*(C`gmtime\*(C'\fR, \f(CW\*(C`localtime\*(C'\fR: use
*\f(CW\*(C`_r\*(C'\fR variants
.IP "\(bu" 4
\&\f(CW\*(C`strtok\*(C'\fR: use \f(CW\*(C`strtok_r\*(C'\fR
.IP "\(bu" 4
\&\f(CW\*(C`tmpnam\*(C'\fR: use \f(CW\*(C`tmpnam_r\*(C'\fR
.IP "\(bu" 4
Many others (lookup documentation)
.RE
.RS 4
.RE
.IP "\(bu" 4
A header file named \fIrrd_is_thread_safe.h\fR is provided
that works with the \s-1GNU\s0 C\-preprocessor to \*(L"poison\*(R" some of the most
common non-thread-safe functions using the \f(CW\*(C`#pragma GCC poison\*(C'\fR
directive. Just include this header in source files you want to keep
thread\-safe.
.IP "\(bu" 4
Do not introduce global variables!
.Sp
If you really, really have to use a global variable you may add a new
field to the \f(CW\*(C`rrd_context\*(C'\fR structure and modify \fIrrd_error.c\fR,
\&\fIrrd_thread_safe.c\fR and \fIrrd_non_thread_safe.c\fR
.IP "\(bu" 4
Do not use \f(CW\*(C`getopt\*(C'\fR or \f(CW\*(C`getopt_long\*(C'\fR in *\f(CW\*(C`_r\*(C'\fR (neither directly nor
indirectly).
.Sp
\&\f(CW\*(C`getopt\*(C'\fR uses global variables and behaves badly in a multi-threaded
application when called concurrently. Instead provide a *_r function
taking all options as function parameters. You may provide argc and
**argv arguments for variable length argument lists. See
\&\f(CW\*(C`rrd_update_r\*(C'\fR as an example.
.IP "\(bu" 4
Do not use the \f(CW\*(C`parsetime\*(C'\fR function!
.Sp
It uses lots of global variables. You may use it in functions not designed
to be thread\-safe, like in functions wrapping the \f(CW\*(C`_r\*(C'\fR version of some
operation (e.g., \f(CW\*(C`rrd_create\*(C'\fR, but not in \f(CW\*(C`rrd_create_r\*(C'\fR)
.Sh "\s-1CURRENTLY\s0 \s-1IMPLEMENTED\s0 \s-1THREAD\s0 \s-1SAFE\s0 \s-1FUNCTIONS\s0"
.IX Subsection "CURRENTLY IMPLEMENTED THREAD SAFE FUNCTIONS"
Currently there exist thread-safe variants of \f(CW\*(C`rrd_update\*(C'\fR,
\&\f(CW\*(C`rrd_create\*(C'\fR, \f(CW\*(C`rrd_dump\*(C'\fR, \f(CW\*(C`rrd_info\*(C'\fR and \f(CW\*(C`rrd_last\*(C'\fR.
.SH "AUTHOR"
.IX Header "AUTHOR"
Peter Stamfest <peter@stamfest.at>
