Author: Qingtao Cao <qingtao.cao@gmail.com>
Date:   Tue Feb 26 13:21:47 2019 +1000

    OG-6686 udhcpc: update server address on reception of DHCPACK
    
    If the DHCP server restarts on a different address but agrees upon the address
    already leased to the client, the client will fail to renew its lease at T1
    timeout via unicast request but will succeed at T2 timeout via broadcast
    request
    
    If this is the case, update the client's copy of the server's address, if the
    serverid option is available in the DHCP ACK
    
    This helps improve the efficiency for the client to renew successfully at the
    next T1 timeout.
Index: busybox-1.33.1/networking/udhcp/dhcpc.c
===================================================================
--- busybox-1.34.1.org/networking/udhcp/dhcpc.c	2021-07-21 00:57:20.000000000 +1000
+++ busybox-1.34.1/networking/udhcp/dhcpc.c	2021-12-15 10:06:24.722147012 +1000
@@ -1791,6 +1791,17 @@
 
 				change_listen_mode(LISTEN_NONE);
 
+				/*
+				 * A success to rebind at T2 implies failure
+				 * to renew at T1. Update server's address
+				 */
+				if (client_data.state == REBINDING) {
+					temp = udhcp_get_option32(&packet, DHCP_SERVER_ID);
+					if (temp) {
+						move_from_unaligned32(server_id, temp);
+					}
+				}
+
 				temp_addr.s_addr = server_id;
 				strcpy(server_str, inet_ntoa(temp_addr));
 				temp_addr.s_addr = packet.yiaddr;
