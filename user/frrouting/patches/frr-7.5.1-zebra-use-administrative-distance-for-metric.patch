From 4baaa8d95f8dbea098d076a68d50a22ae467c4e2 Mon Sep 17 00:00:00 2001
From: "Sreeves, Francis" <francis.sreeves@digi.com>
Date: Wed, 21 Apr 2021 11:37:18 +0100
Subject: [PATCH] zebra: use administrative distance for metric

Insert routes with metric equal to the protocol's standardised
administrative distance. Previously, metric 20 was used for all
protocols.

DAL-2651
---
 zebra/rt_netlink.c | 2 +-
 zebra/rt_netlink.h | 2 --
 2 files changed, 1 insertion(+), 3 deletions(-)

diff --git a/zebra/rt_netlink.c b/zebra/rt_netlink.c
index 770feb5..6fd951a 100644
--- a/zebra/rt_netlink.c
+++ b/zebra/rt_netlink.c
@@ -1683,7 +1683,7 @@ ssize_t netlink_route_multipath_msg_encode(int cmd,
 	 * by the routing protocol and for communicating with protocol peers.
 	 */
 	if (!nl_attr_put32(&req->n, datalen, RTA_PRIORITY,
-			   NL_DEFAULT_ROUTE_METRIC))
+			   dplane_ctx_get_distance(ctx)))
 		return 0;
 
 #if defined(SUPPORT_REALMS)
diff --git a/zebra/rt_netlink.h b/zebra/rt_netlink.h
index e1bb844..3058438 100644
--- a/zebra/rt_netlink.h
+++ b/zebra/rt_netlink.h
@@ -30,8 +30,6 @@
 extern "C" {
 #endif
 
-#define NL_DEFAULT_ROUTE_METRIC 20
-
 /*
  * Additional protocol strings to push into routes
  * If we add anything new here please make sure
-- 
2.17.1

